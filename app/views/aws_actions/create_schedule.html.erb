<% content_for :breadcrumbs do %>
	<div id="breadcrumbs">
		<ul class="breadcrumb">
			<li><i class="icon-home"></i><a href="<%= root_path %>">Home</a><span class="divider"><i class="icon-angle-right"></i></span></li>
			<li class="active">Create Schedule<span class="divider"></span></li>
		</ul>
	</div>
<% end %>
<% content_for :header do %>
	<div class="page-header position-relative">
		<h1>Create Schedule</h1>
	</div><!--/page-header-->
<% end %>

	<div class="span12">
		<div class="widget-box">
			<div class="widget-header widget-header-blue widget-header-flat wi1dget-header-large">
				<h4 class="lighter">Create Schedule Wizard</h4>
			</div>

			<div class="widget-body">
				<div class="widget-main">

					<div class="row-fluid">
						<div id="fuelux-wizard" class="row-fluid hidden">
							<ul class="wizard-steps">
								<li data-target="#step1" class="active"><span class="step">1</span> <span class="title">Select Instances</span></li>
								<li data-target="#step2"><span class="step">2</span> <span class="title">Select Schedule</span></li>
								<li data-target="#step3"><span class="step">3</span> <span class="title">Verify</span></li>
								
							</ul>
						</div>

						<hr />

						<div class="step-content row-fluid position-relative">
								<div class="step-pane active " id="step1">
									<div class="row-fluid">
										<div class="span8 offset2">
											<div class="widget-box">
												<div class="widget-header widget-header-small header-color-orange">
													<h3>Selected Instances</h3>
												</div>
												
												<div class="widget-body">
														<table id="table_bug_report" class="table table-hover">
															<thead>
																<tr>
																	<th>Name</th>
																	<th>Instance ID</th>
																	<th>Instance Type</th>
																	<th>State</th>
																	<th>Actions</th>
																</tr>
															</thead>
													 		<% if @selected_instances.blank? %>
																<tbody id="added_instances">
																</tbody>
															<% else %>
															<tbody id="added_instances">
															<% @selected_instances.each do |instance| %>
																<tr>
																	<td>
																		<%= instance.tag_set.find{|ts| ts[:key]=="Name"}[:value] if instance.tag_set.find{|ts| ts[:key]=="Name"}%>
																	</td>
																	<td><%= instance.instance_id %></td>
																	<td><%= instance.instance_type %></td>
																	<td>
																		<% inst_state = instance.instance_state[:name] %>
																		<%= content_tag :span, class: instance_state_class(inst_state) do %>
																			<%= inst_state.camelize %>
																		<% end %>
																	</td>
																	<td>
																		<div class="inline position-relative">
																			<button id=<%= instance.instance_id%> class="btn btn-minier btn-danger remove-instance"><i class="icon-trash icon-white"></i></button>
																		</div>
																	</td>
																</tr>
															<% end %>
														</tbody>
													<% end %>
													</table>
													<div class="center" id='msg'>
														No Instance added Yet
													</div>
												</div>
											</div>
										</div>
									</div>
									<div class="row-fluid" id="add_more_instances">
										<div class="span8 offset2">
											<div class="widget-box">
												<div class="widget-header widget-header-small ">
													<h3>Add More Instances</h3>
												</div>
												
												<div class="widget-body">
												 <div class="widget-main">
													<div class="row-fluid">
														<div class="form-inline span12">
															<b>Region: </b>
															&nbsp;
															&nbsp;
															<%= select_tag "region", options_for_select(["us-east-1", "us-west-2", "us-west-1", "eu-west-1", "ap-southeast-1", "ap-southeast-2", "ap-northeast-1", "sa-east-1"], "us-east-1"), id: 'filter-region' %>
															&nbsp;
															<br />
															<br />
															<b>Filters: </b>
															&nbsp;
															&nbsp;
															<%= select_tag "filters", options_for_select(["None", "Instance ID", "AMI", "Volume ID", "Tags"], "None"), id: 'select-instance-wizard-filter'%>
															<%= text_field_tag "key", nil, placeholder: 'Key', class: 'input-small', id: 'wizard-filter-key', style: 'display:none;' %>
															<%= text_field_tag "value", nil, placeholder: 'Value', class: 'input-small', id: 'wizard-filter-value', style: 'display:none;' %>
															<input type="button" id = "search-by-instance-filter" value="Search By Instance Filter" class="search-by-instance-filters" >
														</div>
													</div>
													<br />
													<div class="row-fluid">
														<div class="span12">
															<table id="table_bug_report" class="table table-hover table-condensed">
																<thead>
																	<tr>
																		<th>Name</th>
																		<th>Instance ID</th>
																		<th>Instance Type</th>
																		<th>State</th>
																		<th>Actions</th>
																	</tr>
																</thead>
																<% if @default_region_instances.blank? %>
																	<tbody id="filtered-instances">
																		<tr>
																			<td class="center" colspan="5"><b>No Instance to add from selected region</b></td>
																		</tr>
																	</tbody>
															<% else %>
															<tbody id="filtered-instances">
																<% @default_region_instances.each do |instance| %>
																	<tr>
																		<td>
																			<%= instance.tag_set.find{|ts| ts[:key]=="Name"}[:value] if instance.tag_set.find{|ts| ts[:key]=="Name"}%>
																		</td>
																		<td><%= instance.instance_id %></td>
																		<td><%= instance.instance_type %></td>
																		<td>
																			<% inst_state = instance.instance_state[:name] %>
																			<%= content_tag :span, class: instance_state_class(inst_state) do %>
																				<%= inst_state.camelize %>
																			<% end %>
																		</td>
																		<td>
																			<div class="inline position-relative">
																				<button id=<%= instance.instance_id%> class="btn btn-minier btn-primary add-instance"><i class="icon-plus icon-white"></i>Add</button>
																			</div>
																		</td>
																	</tr>
																<% end %>
															</tbody>
														</table>
														<% end %>
														</div>
													</div>
												</div>
											</div>
										</div>
									</div>
								</div>
								<div class="step-pane" id="step2">

								</div>

								<div class="step-pane" id="step3">
									<div class="center">
										<h3 class="blue lighter">Summary</h3>
									</div>

									<br/>

								</div>

						</div>
						
						<hr />
						
						<div class="row-fluid wizard-actions">
							<button class="btn btn-prev"><i class="icon-arrow-left"></i> Prev</button>
							<button class="btn btn-success btn-next" data-last="Finish ">Next <i class="icon-arrow-right icon-on-right"></i></button>
						</div>
					</div>

				</div><!--/widget-main-->
			</div><!--/widget-body-->
		</div>
	</div>
</div>

<script type='text/javascript'>
	window.onload = function() {
		<% if params[:inst] %>
			$('#msg').hide();
			$('#add_more_instances').hide();
		<% end %>
	};
	
	$(function() {

		$('[data-rel=tooltip]').tooltip();

		$(".chzn-select").css('width','150px').chosen({allow_single_deselect:true , no_results_text: "No such state!"})
		.on('change', function(){
		$(this).closest('form').validate().element($(this));
		});
		var $validation = false;
		$('#fuelux-wizard').ace_wizard().on('change' , function(e, info) {
			if(info.step == 1) {

			}
			if(info.step == 2) {

			}
		}).on('finished', function(e) {
		$('button.btn-next').attr('disabled', 'disabled')
		});
	});
</script>